<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cohesity Service Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="app"></div>
  <script>
    const SUPABASE_URL = 'https://ghwsrqzarxuqfajugdta.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_7WwLwZAfl8H1FEkD3TJ-9A_3sbt7J4h';
    const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let currentUser = null;

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { data, error } = await db.from('users').select('*').eq('email', email).single();
      if (error || !data || data.password !== password) { alert('Invalid credentials'); return; }
      currentUser = data;
      renderHome();
    }

    function logout() { currentUser = null; renderLogin(); }

    function renderLogin() {
      document.getElementById('app').innerHTML = '<div class="min-h-screen bg-gradient-to-br from-purple-600 to-indigo-700 flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md"><div class="text-center mb-8"><div class="w-16 h-16 bg-purple-600 rounded-full mx-auto flex items-center justify-center mb-4"><span class="material-icons text-white text-3xl">business</span></div><h1 class="text-2xl font-bold text-gray-800">Cohesity Service Portal</h1><p class="text-gray-500 mt-2">Employee Self-Service Center</p></div><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="email" value="demo@cohesity.com" class="w-full px-4 py-3 border rounded-lg"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Password</label><input type="password" id="password" value="password123" class="w-full px-4 py-3 border rounded-lg"></div><button onclick="login()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700">Sign In</button></div></div></div>';
    }

    async function renderHome() {
      const { data: items } = await db.from('catalog_items').select('*, categories(name)').eq('is_active', true).limit(6);
      const { data: categories } = await db.from('categories').select('*').eq('is_active', true);
      let catHtml = '';
      (categories || []).forEach(function(cat) { catHtml += '<div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition cursor-pointer"><span class="material-icons text-purple-600 text-3xl mb-2">' + (cat.icon || 'category') + '</span><h3 class="font-semibold text-gray-800">' + cat.name + '</h3><p class="text-sm text-gray-500 mt-1">' + (cat.description || '') + '</p></div>'; });
      let itemsHtml = '';
      (items || []).forEach(function(item) { itemsHtml += '<div class="bg-white rounded-xl p-6 shadow-sm hover:shadow-md transition cursor-pointer"><div class="flex items-start space-x-4"><div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"><span class="material-icons text-purple-600">' + (item.icon || 'category') + '</span></div><div><h4 class="font-semibold text-gray-800">' + item.name + '</h4><p class="text-sm text-gray-500 mt-1">' + (item.short_description || '') + '</p><span class="inline-block mt-2 text-xs bg-gray-100 px-2 py-1 rounded">' + (item.categories ? item.categories.name : '') + '</span></div></div></div>'; });
      document.getElementById('app').innerHTML = '<header class="bg-white shadow-sm sticky top-0 z-50"><div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between"><div class="flex items-center space-x-4"><div class="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center"><span class="material-icons text-white">business</span></div><span class="font-bold text-xl text-gray-800">Cohesity Service Portal</span></div><div class="flex items-center space-x-4"><span class="text-gray-600">Welcome, ' + currentUser.display_name + '</span><button onclick="logout()" class="bg-gray-100 px-4 py-2 rounded-lg hover:bg-gray-200">Logout</button></div></div></header><main class="max-w-7xl mx-auto px-4 py-8"><h2 class="text-2xl font-bold text-gray-800 mb-6">Service Categories</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">' + catHtml + '</div><h2 class="text-2xl font-bold text-gray-800 mb-6">Popular Services</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">' + itemsHtml + '</div></main>';
    }
    renderLogin();
  </script>
</body>
</html>
